import subprocess
import time
import os
import json
from urlparse import urlparse
import re
import urllib2
from BeautifulSoup import BeautifulSoup
from bs4 import BeautifulSoup
from js_client import js_Class
#import string; print(string.__file__)


class html_Class():

	def __init__(self, file_name, md5, url):
		self.filename = file_name
		self.url = url
		self.md5 = md5
		self.filepath = "report/"+md5+"/"+file_name
		self.reportpath = "report/"+md5+"/"+file_name + "_swf.report"

	def html_Score(self):
		self.html_scan()
		js = js_Class(self.filename+".js", self.md5)
                status = js.js_Score()

		return status

	def html_scan(self):
		if self.url != None:
			page = urllib2.urlopen(self.url)
			soup = BeautifulSoup(page)
			#script = soup.body.find('script')
			html = re.findall(r'<script>(.*?)</script>', str(soup), re.DOTALL)
			for i in html:
				f = open(self.filepath+".js", 'w')
				f.write(str(i))
			f.close()

		if self.url == None:
			with open(self.filepath) as f:
        			data = f.read().replace('\n', ' ')
				soup = BeautifulSoup(data, 'html.parser')
				html = re.findall(r'<script>(.*?)</script>', str(data), re.DOTALL)
				for i in html:
					f = open(self.filepath+".js", 'w')
					f.write(str(i))
				f.close()

if __name__ == "__main__":
	res = html_Class('index.html', '31c032f34f1c2561488e898c451e0666', "http://www.google.com")
	status = res.html_Score()
	print status
