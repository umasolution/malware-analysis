<html><head>
<title>lib/patterns_client.py</title>
<meta name="Generator" content="htmlizer/[twisted, version 13.2.0]" />
<link rel="alternate" href="lib/patterns_client.py" type="text/x-python" />

</head>
<body>
<pre><span class="py-src-keyword">import</span> <span class="py-src-variable">subprocess</span>
<span class="py-src-keyword">from</span> <span class="py-src-variable">urlparse</span> <span class="py-src-keyword">import</span> <span class="py-src-variable">urlparse</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">time</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">os</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">json</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">re</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">patterns_Class</span>():

	<span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">file_name</span>, <span class="py-src-parameter">md5</span>):
		<span class="py-src-variable">self</span>.<span class="py-src-variable">filename</span> = <span class="py-src-variable">file_name</span>
  <span class="py-src-variable">self</span>.<span class="py-src-variable">filepath</span> = <span class="py-src-string">"report/"</span>+ <span class="py-src-variable">md5</span> +<span class="py-src-string">"/"</span>+ <span class="py-src-variable">file_name</span>
  <span class="py-src-variable">self</span>.<span class="py-src-variable">reportpath</span> = <span class="py-src-string">"report/"</span>+ <span class="py-src-variable">md5</span> +<span class="py-src-string">"/"</span>+ <span class="py-src-variable">file_name</span> +<span class="py-src-string">"_pattern.report"</span>
  <span class="py-src-variable">self</span>.<span class="py-src-variable">pat_scan</span>()
  <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">1</span>

                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">reportpath</span>, <span class="py-src-string">'r'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">myfile</span>:
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">data</span>=<span class="py-src-variable">myfile</span>.<span class="py-src-variable">read</span>().<span class="py-src-variable">replace</span>(<span class="py-src-string">'\n'</span>, <span class="py-src-string">''</span>)

  
                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">'data/ipblock.list'</span>, <span class="py-src-string">'r'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">myfile</span>:
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">iplist</span>=<span class="py-src-variable">myfile</span>.<span class="py-src-variable">read</span>().<span class="py-src-variable">replace</span>(<span class="py-src-string">'\n'</span>, <span class="py-src-string">' '</span>)

                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">'data/urlblock.list'</span>, <span class="py-src-string">'r'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">myfile</span>:
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">urllist</span>=<span class="py-src-variable">myfile</span>.<span class="py-src-variable">read</span>().<span class="py-src-variable">replace</span>(<span class="py-src-string">'\n'</span>, <span class="py-src-string">' '</span>)

                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">'data/emailblock.list'</span>, <span class="py-src-string">'r'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">myfile</span>:
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">emaillist</span>=<span class="py-src-variable">myfile</span>.<span class="py-src-variable">read</span>().<span class="py-src-variable">replace</span>(<span class="py-src-string">'\n'</span>, <span class="py-src-string">' '</span>)

                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">'data/pattern.list'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">myfile</span>:
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">patternlist</span>=<span class="py-src-variable">myfile</span>.<span class="py-src-variable">readlines</span>()

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">check_pattern</span>(<span class="py-src-parameter">self</span>):
                <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">reportpath</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">rp</span>:
			<span class="py-src-variable">lines</span> = <span class="py-src-variable">rp</span>.<span class="py-src-variable">readlines</span>()
   <span class="py-src-keyword">for</span> <span class="py-src-variable">line</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">lines</span>:
				<span class="py-src-keyword">print</span> <span class="py-src-string">"line %s"</span> % <span class="py-src-variable">line</span>
    <span class="py-src-keyword">for</span> <span class="py-src-variable">pat</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">patternlist</span>:
					<span class="py-src-keyword">print</span> <span class="py-src-string">"pat %s"</span> % <span class="py-src-variable">pat</span>
     <span class="py-src-variable">pat_search</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+<span class="py-src-variable">pat</span>+<span class="py-src-string">')'</span>, <span class="py-src-variable">line</span>)
                   <span class="py-src-keyword">if</span> <span class="py-src-variable">pat_search</span>:
						<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>

     
  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span>

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">check_email</span>(<span class="py-src-parameter">self</span>):
  
                <span class="py-src-variable">emails</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">findall</span>(<span class="py-src-string">r'[\w\-][\w\-\.]+@[\w\-][\w\-\.]+[a-zA-Z]{1,4}'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">data</span>)
  
  <span class="py-src-keyword">for</span> <span class="py-src-variable">email</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">emails</span>:
			<span class="py-src-variable">email_search</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">email</span> +<span class="py-src-string">')'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">emaillist</span>)
   <span class="py-src-keyword">if</span> <span class="py-src-variable">email_search</span>:
				<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>

  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span>
  

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">check_url</span>(<span class="py-src-parameter">self</span>):

                <span class="py-src-variable">urls</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">findall</span>(<span class="py-src-string">'http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">data</span>)

                <span class="py-src-keyword">for</span> <span class="py-src-variable">url</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">urls</span>:
                        <span class="py-src-variable">o</span> = <span class="py-src-variable">urlparse</span>(<span class="py-src-variable">url</span>)
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">url_full</span> = <span class="py-src-variable">o</span>.<span class="py-src-variable">geturl</span>()
                        <span class="py-src-variable">self</span>.<span class="py-src-variable">domain</span> = <span class="py-src-variable">o</span>.<span class="py-src-variable">netloc</span>

   <span class="py-src-variable">url_search</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">self</span>.<span class="py-src-variable">url_full</span> +<span class="py-src-string">')'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">urllist</span>)
   <span class="py-src-keyword">if</span> <span class="py-src-variable">url_search</span>:
				<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>

   <span class="py-src-variable">domain_search</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">self</span>.<span class="py-src-variable">domain</span> +<span class="py-src-string">')'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">urllist</span>)
   <span class="py-src-keyword">if</span> <span class="py-src-variable">domain_search</span>:
				<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>
 
  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span>


 <span class="py-src-keyword">def</span> <span class="py-src-identifier">check_ip</span>(<span class="py-src-parameter">self</span>):
		<span class="py-src-variable">ips</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">findall</span>(<span class="py-src-string">r"\d{1,3}(?:\.\d{1,3}){3}"</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">data</span>)
  <span class="py-src-keyword">for</span> <span class="py-src-variable">ip</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">ips</span>:
			<span class="py-src-variable">ip_search</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">ip</span> +<span class="py-src-string">')'</span>, <span class="py-src-variable">self</span>.<span class="py-src-variable">iplist</span>)
   <span class="py-src-keyword">if</span> <span class="py-src-variable">ip_search</span>:
				<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>

  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span>

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">get_Score</span>(<span class="py-src-parameter">self</span>):
		<span class="py-src-variable">check</span> = <span class="py-src-variable">True</span>
  <span class="py-src-variable">final_status</span> = []
  <span class="py-src-variable">self</span>.<span class="py-src-variable">res1</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">check_url</span>()
  <span class="py-src-variable">final_status</span>.<span class="py-src-variable">append</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">res1</span>)
  <span class="py-src-variable">self</span>.<span class="py-src-variable">res2</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">check_ip</span>()
  <span class="py-src-variable">final_status</span>.<span class="py-src-variable">append</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">res2</span>)
  <span class="py-src-variable">self</span>.<span class="py-src-variable">res3</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">check_email</span>()
  <span class="py-src-variable">final_status</span>.<span class="py-src-variable">append</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">res3</span>)
  <span class="py-src-variable">self</span>.<span class="py-src-variable">res4</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">check_pattern</span>()
  <span class="py-src-variable">final_status</span>.<span class="py-src-variable">append</span>(<span class="py-src-variable">self</span>.<span class="py-src-variable">res4</span>)

         <span class="py-src-keyword">for</span> <span class="py-src-variable">status</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">final_status</span>:
                	<span class="py-src-keyword">if</span> <span class="py-src-variable">status</span> == <span class="py-src-number">3</span>:
                        	<span class="py-src-variable">status</span> = <span class="py-src-number">3</span>
                         <span class="py-src-variable">check</span> = <span class="py-src-variable">False</span>
                 <span class="py-src-keyword">if</span> <span class="py-src-variable">check</span>:
                        	<span class="py-src-keyword">if</span> <span class="py-src-variable">status</span> == <span class="py-src-number">2</span>:
                                	<span class="py-src-variable">status</span> = <span class="py-src-number">2</span>
                                 <span class="py-src-variable">check</span> = <span class="py-src-variable">False</span>
                 <span class="py-src-keyword">if</span> <span class="py-src-variable">check</span>:
                        	<span class="py-src-keyword">if</span> <span class="py-src-variable">status</span> == <span class="py-src-number">1</span>:
                                	<span class="py-src-variable">status</span> = <span class="py-src-number">1</span>


  <span class="py-src-keyword">return</span> <span class="py-src-variable">status</span>
  

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">pat_scan</span>(<span class="py-src-parameter">self</span>):
		<span class="py-src-variable">os</span>.<span class="py-src-variable">system</span>(<span class="py-src-string">"python tools/balbuzard/balbuzard.py "</span> + <span class="py-src-variable">self</span>.<span class="py-src-variable">filepath</span> + <span class="py-src-string">" &gt; "</span>+ <span class="py-src-variable">self</span>.<span class="py-src-variable">reportpath</span>)


<span class="py-src-keyword">if</span> <span class="py-src-variable">__name__</span> == <span class="py-src-string">"__main__"</span>:
	<span class="py-src-variable">res</span> = <span class="py-src-variable">patterns_Class</span>(<span class="py-src-string">'sample1.doc'</span>,<span class="py-src-string">'31c032f34f1c2561488e898c451e0666'</span>)
 <span class="py-src-variable">status</span> = <span class="py-src-variable">res</span>.<span class="py-src-variable">get_Score</span>()
 <span class="py-src-keyword">print</span> <span class="py-src-variable">status</span>
</pre>
</body>