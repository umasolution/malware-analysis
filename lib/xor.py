import magic
import os
import sys
import re

class xor_Scan():
	def __init__(self, filepath, md5):
		self.filepath = filepath
		self.md5 = str(md5)
		self.status = 1 

	def scan_file(self):
		os.system("tools/xorsearch/xorsearch -h "+ self.filepath + " 50450000 > report/"+self.md5+"/pe_attach.info")
		os.system("tools/xorsearch/xorsearch -W "+ self.filepath + " > report/"+self.md5+"/xor.info")

	def get_pedetails(self):
		if os.path.getsize("report/"+self.md5+"/pe_attach.info") != 0:
			status = 2
			return status

	def get_details(self):
		with open("report/"+self.md5+"/xor.info") as data:
			rs = data.readlines()
			for r in rs:
				mal_str = re.search(r'(Suspicious)', r)
				if mal_str:
					status = 2
					return status

	def final_results(self):
		final_status = []
		check = True
		self.scan_file()
		status = self.get_pedetails()
		final_status.append(status)
		status = self.get_details()
		final_status.append(status)

                for status in final_status:
                        if status == 3:
                                status = 3
                                check = False
                        if check:
                                if status == 2:
                                        status = 2
                                        check = False
                        if check:
                                if status == 1:
                                        status = 1

                return status



if __name__ == "__main__":
	res = xor_Scan('/home/versa/malware1', 'acc9f0271432b4d14e0fe4913dc8e62e')
	print res.final_results() 

