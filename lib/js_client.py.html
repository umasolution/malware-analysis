<html><head>
<title>lib/js_client.py</title>
<meta name="Generator" content="htmlizer/[twisted, version 13.2.0]" />
<link rel="alternate" href="lib/js_client.py" type="text/x-python" />

</head>
<body>
<pre><span class="py-src-keyword">import</span> <span class="py-src-variable">subprocess</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">time</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">os</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">json</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">re</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">spidermonkey</span>
<span class="py-src-keyword">import</span> <span class="py-src-variable">enchant</span>

<span class="py-src-keyword">class</span> <span class="py-src-identifier">js_Class</span>():

	<span class="py-src-keyword">def</span> <span class="py-src-identifier">__init__</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">file_name</span>, <span class="py-src-parameter">md5</span>):
		<span class="py-src-variable">self</span>.<span class="py-src-variable">filename</span> = <span class="py-src-variable">file_name</span>
  <span class="py-src-variable">self</span>.<span class="py-src-variable">md5</span> = <span class="py-src-variable">md5</span>
  <span class="py-src-variable">self</span>.<span class="py-src-variable">fun</span> = [<span class="py-src-string">'String'</span>, <span class="py-src-string">'eval'</span>]
  <span class="py-src-variable">self</span>.<span class="py-src-variable">rt</span> = <span class="py-src-variable">spidermonkey</span>.<span class="py-src-variable">Runtime</span>()
  <span class="py-src-variable">self</span>.<span class="py-src-variable">cx</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">rt</span>.<span class="py-src-variable">new_context</span>()

  <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">"report/"</span>+<span class="py-src-variable">self</span>.<span class="py-src-variable">md5</span>+<span class="py-src-string">"/"</span>+<span class="py-src-variable">self</span>.<span class="py-src-variable">filename</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">file1</span>:
			<span class="py-src-variable">self</span>.<span class="py-src-variable">data1</span> = <span class="py-src-variable">file1</span>.<span class="py-src-variable">readlines</span>()

  <span class="py-src-keyword">with</span> <span class="py-src-variable">open</span>(<span class="py-src-string">'data/string_sig/malware_js'</span>) <span class="py-src-keyword">as</span> <span class="py-src-variable">malware</span>:
			<span class="py-src-variable">self</span>.<span class="py-src-variable">mal</span>=<span class="py-src-variable">malware</span>.<span class="py-src-variable">read</span>().<span class="py-src-variable">splitlines</span>()

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">find_between</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">s</span>, <span class="py-src-parameter">first</span>, <span class="py-src-parameter">last</span> ):
    		<span class="py-src-keyword">try</span>:
        		<span class="py-src-variable">start</span> = <span class="py-src-variable">s</span>.<span class="py-src-variable">index</span>( <span class="py-src-variable">first</span> ) + <span class="py-src-variable">len</span>( <span class="py-src-variable">first</span> )
          <span class="py-src-variable">end</span> = <span class="py-src-variable">s</span>.<span class="py-src-variable">index</span>( <span class="py-src-variable">last</span>, <span class="py-src-variable">start</span> )
          <span class="py-src-keyword">return</span> <span class="py-src-variable">s</span>[<span class="py-src-variable">start</span>:<span class="py-src-variable">end</span>]
      <span class="py-src-keyword">except</span> <span class="py-src-variable">ValueError</span>:
       			<span class="py-src-keyword">return</span> <span class="py-src-string">""</span>

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">find_dict</span>(<span class="py-src-parameter">self</span>, <span class="py-src-parameter">w</span>):
		<span class="py-src-variable">d</span> = <span class="py-src-variable">enchant</span>.<span class="py-src-variable">Dict</span>(<span class="py-src-string">"en_US"</span>)
  <span class="py-src-variable">self</span>.<span class="py-src-variable">r_value</span> = <span class="py-src-variable">d</span>.<span class="py-src-variable">check</span>(<span class="py-src-variable">w</span>)
  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">r_value</span>
  

 <span class="py-src-keyword">def</span> <span class="py-src-identifier">js_Score</span>(<span class="py-src-parameter">self</span>):
		<span class="py-src-variable">get_score</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">js_scan</span>()
  <span class="py-src-keyword">return</span> <span class="py-src-variable">get_score</span>


 <span class="py-src-keyword">def</span> <span class="py-src-identifier">js_scan</span>(<span class="py-src-parameter">self</span>):
		<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">1</span>
  <span class="py-src-keyword">for</span> <span class="py-src-variable">data</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">data1</span>:
			<span class="py-src-keyword">for</span> <span class="py-src-variable">fun1</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">fun</span>:
				<span class="py-src-variable">f</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'(var.*=\'.*\';)'</span>, <span class="py-src-variable">data</span>)
    <span class="py-src-keyword">if</span> <span class="py-src-variable">f</span>:
					<span class="py-src-variable">f</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'(var.*=\'.*\';)'</span>, <span class="py-src-variable">data</span>).<span class="py-src-variable">group</span>(<span class="py-src-number">0</span>)
     <span class="py-src-variable">output1</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">cx</span>.<span class="py-src-variable">execute</span>(<span class="py-src-variable">f</span>)
     <span class="py-src-variable">dfg</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+<span class="py-src-variable">fun1</span>+<span class="py-src-string">'.*\()'</span>, <span class="py-src-variable">data</span>)
     <span class="py-src-keyword">if</span> <span class="py-src-variable">dfg</span>:
						<span class="py-src-keyword">for</span> <span class="py-src-variable">mal</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">mal</span>:
							<span class="py-src-variable">f_dict</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+<span class="py-src-variable">mal</span>+<span class="py-src-string">')'</span>, <span class="py-src-variable">output1</span>)
       <span class="py-src-keyword">if</span> <span class="py-src-variable">f_dict</span>:
								<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>
        <span class="py-src-comment">#return self.score</span>

    <span class="py-src-comment">#f1 = re.search(r'('+ fun1  +'.*\(.*[a-zA-Z0-9]\);)', data)</span>
    <span class="py-src-variable">f3</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">findall</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">fun1</span>  +<span class="py-src-string">'.*\(.*[a-zA-Z0-9]\);)'</span>, <span class="py-src-variable">data</span>)
    <span class="py-src-keyword">if</span> <span class="py-src-variable">f3</span>:
					<span class="py-src-keyword">for</span> <span class="py-src-variable">f1</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">f3</span>:
						<span class="py-src-variable">f2</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'('</span>+ <span class="py-src-variable">fun1</span>  +<span class="py-src-string">'.*\(.*[a-zA-Z0-9]\);)'</span>, <span class="py-src-variable">data</span>).<span class="py-src-variable">group</span>(<span class="py-src-number">0</span>)
      <span class="py-src-variable">df</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">search</span>(<span class="py-src-string">r'\(.*\)'</span>, <span class="py-src-variable">f2</span>).<span class="py-src-variable">group</span>(<span class="py-src-number">0</span>)
      <span class="py-src-variable">match_str</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">sub</span>(<span class="py-src-string">r'^\(|\)$'</span>, <span class="py-src-string">''</span>, <span class="py-src-variable">df</span>)
      <span class="py-src-variable">f_dict</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">find_dict</span>(<span class="py-src-variable">match_str</span>)
      <span class="py-src-keyword">if</span> <span class="py-src-keyword">not</span> <span class="py-src-variable">f_dict</span>:
							<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>
       <span class="py-src-comment">#return self.score</span>
    <span class="py-src-keyword">else</span>:
					<span class="py-src-variable">df3</span> = <span class="py-src-variable">re</span>.<span class="py-src-variable">findall</span>(<span class="py-src-string">r'('</span>+<span class="py-src-variable">fun1</span>+<span class="py-src-string">'.*\()'</span>, <span class="py-src-variable">data</span>)
     <span class="py-src-keyword">if</span> <span class="py-src-variable">df3</span>:
						<span class="py-src-keyword">for</span> <span class="py-src-variable">df</span> <span class="py-src-keyword">in</span> <span class="py-src-variable">df3</span>:
							<span class="py-src-variable">df1</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">find_between</span>( <span class="py-src-variable">data</span>, <span class="py-src-string">"("</span>, <span class="py-src-string">");"</span> )
       <span class="py-src-variable">output2</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">cx</span>.<span class="py-src-variable">execute</span>(<span class="py-src-variable">df1</span>)
       <span class="py-src-variable">f_dict</span> = <span class="py-src-variable">self</span>.<span class="py-src-variable">find_dict</span>(<span class="py-src-variable">output2</span>)
       <span class="py-src-keyword">if</span> <span class="py-src-keyword">not</span> <span class="py-src-variable">f_dict</span>:
								<span class="py-src-variable">self</span>.<span class="py-src-variable">score</span> = <span class="py-src-number">3</span>
        <span class="py-src-comment">#return self.score</span>

  <span class="py-src-keyword">return</span> <span class="py-src-variable">self</span>.<span class="py-src-variable">score</span>

<span class="py-src-keyword">if</span> <span class="py-src-variable">__name__</span> == <span class="py-src-string">"__main__"</span>:
	<span class="py-src-variable">res</span> = <span class="py-src-variable">js_Class</span>(<span class="py-src-string">'index.html.js'</span>, <span class="py-src-string">'31c032f34f1c2561488e898c451e0666'</span>)
 <span class="py-src-variable">status</span> = <span class="py-src-variable">res</span>.<span class="py-src-variable">js_Score</span>()  
 <span class="py-src-keyword">print</span> <span class="py-src-variable">status</span>

</pre>
</body>