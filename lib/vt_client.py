import subprocess
import time
import os
import os.path
import json

class vt_Class():

	def __init__(self, file_name, md5):
		self.file_name = file_name
		self.md5 = md5
		self.configfile = self.virus_total()
		print "config file %s" %self.configfile
        	self.file_sha = subprocess.check_output("sha1sum "+ self.file_name +" | awk '{print $1}'", shell=True)
        	self.file_sha_name = self.file_sha.split('\n')
        	self.filename="VTDL_"+self.file_sha_name[0]+".json" 

	def virus_total(self):
        	os.system("python tools/VirusTotalApi-master/vt/vt.py -j -f " + self.file_name)
		if os.path.isfile(self.file_name):
        		self.file_sha = subprocess.check_output("sha1sum "+ self.file_name +" | awk '{print $1}'", shell=True)
        		self.file_sha_name = self.file_sha.split('\n')
        		self.filename="VTDL_"+self.file_sha_name[0]+".json" 
		else:
        		os.system("touch "+ self.filename)
			
		return self.filename

	def vt_Score(self):
		with open(self.configfile) as config_data:
			cfg = json.load(config_data)
		
		self.positives = cfg['positives']
		print self.positives
		if self.positives == 0:
			self.result = 0
		if self.positives != 0:
			self.result = 3
		
		os.system("mv "+ self.configfile +" report/"+self.md5+"/")
		return self.result

		

if __name__ == "__main__":
        res = vt_Class('/tmp/sample1.doc', '36abd162e5b6a4549500881f3d954886')
        print res.vt_Score()

