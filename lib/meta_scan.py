import magic
import os
import sys
import re
import logfile
import logging

logger = logging.getLogger('Meta-Data')

class meta_Scan():
	def __init__(self, filepath, md5):
		self.filepath = filepath
		self.md5 = str(md5)
		self.status = 1 

	def get_details(self):
		os.system("hachoir-metadata "+ self.filepath + " > report/"+self.md5+"/meta.info")

	def gen_array(self):
		self.get_details()
		with open("report/"+self.md5+"/meta.info") as data:
			rs = data.readlines()
			for r in rs:
				date = re.search(r'(Creation date:)', r)
				logger.info("Get File creation date : %s" % date)
				if date:
					match = re.search(r'(\d+-\d+-\d+)', r)
					final_match = match.group(1)
					if not final_match:
						self.status = 2
						logger.info("Get File status based on meta date status : %s" % self.status)
						return self.status

				if self.status == 1:
					with open('data/meta_string') as data1:
						rs1 = data1.readlines()
						for r1 in rs1:
							match = re.search(r'('+r+')', r1)
							if match:
								self.status = 3
						logger.info("Get File status based on meta string status : %s" % self.status)
						return self.status
			

if __name__ == "__main__":
	res = meta_Scan('/home/versa/xsl1', 'acc9f0271432b4d14e0fe4913dc8e62e')
#	match = re.search(r'(\d+-\d+-\d+)','Creation date: 2000-11-24 03:32:13')
#	date =  match.group(1)
	print res.gen_array() 

