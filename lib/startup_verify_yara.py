import os
import sys
import time
import MySQLdb


class Startup_Sig():
	def __init__(self, file_name, filetype):
		self.file_name = file_name
		self.report_name = file_name + ".tmp"
		self.filetype = filetype
		self.lock = True

        def jpeg_scan(self):
                os.system("/usr/local/bin/yara -w -m data/filetype/jpeg.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result

        def antivm_scan(self):
                os.system("/usr/local/bin/yara -w -m data/antivm.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result


        def clamav_scan(self):
                os.system("/usr/local/bin/yara -w -m data/clamav/main.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result

        def pdf_scan(self):
                os.system("/usr/local/bin/yara -w -m data/filetype/pdf.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result

        def doc_scan(self):
                os.system("/usr/local/bin/yara -w -m data/filetype/doc.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result

        def exe_scan(self):
                os.system("/usr/local/bin/yara -w -m data/filetype/exe.yara " + self.file_name + " > "+ self.report_name)
                if os.path.getsize(self.report_name) != 0:
   	 		result = "3"
		else:
			result = "1"
		return result

        def operational_scan(self):
		with open('data/Operation_Blockbuster/yara.list') as f:
			array = f.read().splitlines()

		for yara_name in array:
                	os.system("/usr/local/bin/yara -w -m data/Operation_Blockbuster/"+ yara_name +" "+ self.file_name + " > "+ self.report_name)
                	if os.path.getsize(self.report_name) != 0:
   	 			result = "3"
				break
			else:
				result = "1"
		return result

        def malware_scan(self):
		with open('data/malware/yara.list') as f:
			array = f.read().splitlines()

		for yara_name in array:
                	os.system("/usr/local/bin/yara -w -m data/malware/"+ yara_name +" "+ self.file_name + " > "+ self.report_name)
                	if os.path.getsize(self.report_name) != 0:
   	 			result = "3"
				break
			else:
				result = "1"

		return result

        def mobile_scan(self):
		with open('data/mobile/yara.list') as f:
			array = f.read().splitlines()

		for yara_name in array:
                	os.system("/usr/local/bin/yara -w -m data/mobile/"+ yara_name +" "+ self.file_name + " > "+ self.report_name)
                	if os.path.getsize(self.report_name) != 0:
   	 			result = "3"
			else:
				result = "1"
		return result
	
	def final_scan(self):
		if self.lock == True:
			res = self.clamav_scan()
			if res == "3":
				self.lock = False
		if self.lock == True:
			res = self.malware_scan()
			if res == "3":
				self.lock = False
		if self.lock == True:
                        res = self.operational_scan()
                        if res == "3":
                                self.lock = False
		if self.lock == True:
			res = self.antivm_scan()
			if res == "3":
				self.lock = False
		if self.lock == True:
			if self.filetype == "msdoc" or self.filetype == "any":
				res = self.doc_scan()
			if self.filetype == "exe" or self.filetype == "any":
				res = self.exe_scan()
			if self.filetype == "pdf" or self.filetype == "any":
				res = self.pdf_scan()
			if self.filetype == "jpeg" or self.filetype == "any":
				res = self.jpeg_scan()
			if self.filetype == "android" or self.filetype == "any":
				res = self.mobile_scan()
 
		return res
		

if __name__ == "__main__":
	res = Startup_Sig('jayesh', 'doc').final_scan()
	print res


