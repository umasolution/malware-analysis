import socket
import time
import argparse


parser = argparse.ArgumentParser()
parser.add_argument("sip", type=str, help="Enter File IP Address")
parser.add_argument("port", type=int, help="Enter Port Number")
parser.add_argument("file_name", type=str, help="Enter File Name")
parser.add_argument("source_type", type=str, help="Enter Source Type")
args = parser.parse_args()

s = socket.socket()
host = args.sip
port = args.port
s.connect((host, port))

s.send("rece")
s.send(args.source_type)
s.recv(4)
s.send(str(len(args.file_name)))
s.send(args.file_name)

f = open(args.file_name,'rb')
l = f.read(1024)
while (l):
   s.send(l)
   l = f.read(1024)
f.close()
s.close()

s1 = socket.socket()
s1.connect((host, port))
s1.send("send")
with open(args.file_name+".json", 'wb') as f:
    result = s1.recv(1)
    print result
    while True:
        data = s1.recv(1024)
        if not data:
            break
        f.write(data)

f.close()
s1.close()
