import spidermonkey
import PyV8 

"""
Adobe object class with some property Majic :)
"""




class app(PyV8.JSClass):
    viewerVersion = 9

    def __init__(self):
        pass

    def document(self):
        return Doc()

   

    doc = property(document)


class Collab(PyV8.JSClass):

    def collectEmailInfo(self, args):
        return "sandeep@versa-networks.com"

    def getIcon(self,args):
        print "Somebody tried to exploit CVE"


class Doc(PyV8.JSClass):
    def syncAnnotScan(self):
        print 'syncAnnotScan  ACESSED '

    def getAnnots(self, args):
        # Let's do some magic here later
        return NULL

    def get_collab(self):
        return Collab()

    Collab = property(get_collab) 


class Global(PyV8.JSClass):

    def get_app(self):
        return app()

    app = property(get_app)




# with monkey
def Scan_JS(jscode):
    
   rt = spidermonkey.Runtime()
   cx = rt.new_context()
   A = app()
   cx.add_global("app",A)
   result = cx.execute(jscode)
   return result
   

   del(cx)
   del(rt)  

#with V8
def Scan_JS_V8(jscode):
   with PyV8.JSContext(Global()) as ctx:
        ctx.eval(jscode)





def main():
   rt = spidermonkey.Runtime()
   cx = rt.new_context()
   fp=file("mal.js",'rb')
   code = fp.read()
   print "Testing Spider \n"
   A = app()
   #cx.add_global("app",A)
   #result = cx.execute(code)
   Scan_JS_V8(code)

if __name__=="__main__":

   main()

